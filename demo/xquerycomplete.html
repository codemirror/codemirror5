<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>CodeMirror: XQuery Autocomplete Demo</title>
    <link rel="stylesheet" href="../lib/codemirror.css">
    <script src="../lib/codemirror.js"></script>
    <script src="../addon/hint/show-hint.js"></script>
    <script src="../addon/hint/xquery/xquery-hint.js"></script>
    <link rel="stylesheet" href="../addon/hint/show-hint-eclipse.css">    
    <link rel="stylesheet" href="../addon/hint/xquery/xquery-hint.css">   
    <script src="../mode/xquery/xquery.js"></script>
    <link rel="stylesheet" href="../doc/docs.css">
    <link rel="stylesheet" href="../theme/xq-light.css">
    <style type="text/css">
      .CodeMirror {
        height:500px;
      }
    </style>    
  </head>
  <body>
    <h1>CodeMirror: XQuery Autocomplete demo</h1>

    <form><textarea id="code" name="code">
xquery version "1.0-ml";
(:
 Copyright 2010 MarkLogic Corporation 
 Copyright 2009 Ontario Council of University Libraries

 Licensed under the Apache License, Version 2.0 (the "License"); 
 you may not use this file except in compliance with the License. 
 You may obtain a copy of the License at 

        http://www.apache.org/licenses/LICENSE-2.0 

 Unless required by applicable law or agreed to in writing, software 
 distributed under the License is distributed on an "AS IS" BASIS, 
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
 See the License for the specific language governing permissions and 
 limitations under the License. 
:)
module namespace oauth2 = "oauth2";
declare namespace xdmphttp="xdmp:http";
import module namespace user = "http://marklogic.com/plugins/security/user" at "../models/user-model.xqy";

(:~
 : Given the user_data map, get the request token and call to Facebook to get profile information
 : populate the profile information in the map (see within for those values
 :) 
declare function oauth2:facebookUserProfileInfo($access_token)  {
    let $profile_url := fn:concat("https://graph.facebook.com/me?access_token=", $access_token)
    let $cmd := fn:concat("xquery version '1.0-ml'; xdmp:http-get('", 
                          $profile_url, 
                          "', <options xmlns='xdmp:http-get'><format xmlns='xdmp:document-get'>text</format></options>)")
    let $profile_response :=  xdmp:eval($cmd)
    return
        if($profile_response[1]/xdmphttp:code/text() eq "200") then
            let $json_response := $profile_response[2]
            let $map_response := xdmp:from-json($profile_response[2])
            let $provider_user_data :=
                <provider-data name="facebook">
                    <id>{map:get($map_response,"id")}</id>
                    <name>{map:get($map_response,"name")}</name>
                    <link>{map:get($map_response,"link")}</link>
                    <gender>{map:get($map_response,"gender")}</gender>
                    <picture>{fn:concat("http://graph.facebook.com/", map:get($map_response,"id"), "/picture" )}</picture>
                </provider-data>
            return
                $provider_user_data
        else 
            ()
    
};

(:~
 : Given the user_data map, get the request token and call to Facebook to get profile information
 : populate the profile information in the map (see within for those values
 :) 
declare function oauth2:githubUserProfileInfo($access_token)  {
    let $profile_url := fn:concat("https://github.com/api/v2/xml/user/show?access_token=", $access_token)
    let $cmd := fn:concat("xquery version '1.0-ml'; xdmp:http-get('", 
                          $profile_url, 
                          "')")
    let $profile_response :=  xdmp:eval($cmd)
    return
        if($profile_response[1]/xdmphttp:code/text() eq "200") then
            let $xml_response := $profile_response[2]
            let $provider_user_data :=
                <provider-data name="github">
                    <id>{$xml_response/user/login/text()}</id>
                    <name>{$xml_response/user/name/text()}</name>
                    <link>{fn:concat("http://github.com/", $xml_response/user/login/text())}</link>
                    <picture>{fn:concat("http://www.gravatar.com/avatar/", $xml_response/user/gravatar-id/text())}</picture>
                </provider-data>
            return
                $provider_user_data
        else 
            ()
    
};

(:~
 : Fetch the user profile info for the given provider, basically a router function
 : @param $provider the provider name corresponding the provider config setup
 : @param $oauth_token_data the oauth2 access_token for the current users session
 : @return the provider-data node() block
 :)
declare function oauth2:getUserProfileInfo($provider, $oauth_token_data)  {
    let $access_token := map:get($oauth_token_data, "access_token")    
    return
    if($provider = "facebook") then
        oauth2:facebookUserProfileInfo($access_token) 
    else
        oauth2:githubUserProfileInfo($access_token) 
};

(:~
 : Parse the response text of an outh2 access token request into the token and 
 : expiration date
 : @param $responseText response text of the access token request
 : @return map containing access_token, expires
 :)
declare function oauth2:parseAccessToken($responseText) as item()+ {
   let $_ := xdmp:log($responseText)
   let $respText := xdmp:binary-decode($responseText, "UTF-8")
   let $_ := xdmp:log($respText)
   let $params := fn:tokenize($respText, "&amp;")
   let $access_token := fn:tokenize($params[1], "=")[2]
   let $expires_seconds := if($params[2] = "expires") then fn:tokenize($params[2], "=")[2] else ()
   let $expires := if($params[2] = "expires") then fn:current-dateTime() + xs:dayTimeDuration(fn:concat("PT", $expires_seconds, "S")) else ()
   let $user_data := map:map()
   let $key := map:put($user_data, "access_token", $access_token)
   let $key := map:put($user_data, "expires", $expires)
   return $user_data
};

(:~
 : Given a provider name and provider user Id, look for a MarkLogic user that's mapped to that provider
 : identity
 :)
declare function oauth2:getOrCreateUserByProvider($providerName as xs:string, 
                                                      $providerUserId as xs:string,
                                                      $providerUserData as node()) 
{                                                  
    let $userDetails :=  /user/provider-data[id/text() eq $providerUserId and @name = $providerName]
    return  
        if($userDetails) then
            fn:doc(xdmp:node-uri($userDetails))/user/@name
        else 
            (: if the user could not be found then create it :)
            let $fullName := $providerUserData/name/text()
            let $description := fn:concat($providerName, " User ", $fullName, " (", $providerUserId, ")")
            let $username := fn:concat($providerName, "_", $providerUserId)
            let $password := xs:string(xdmp:hash32($username))
            let $newuser := user:createNewUser($username, $password, $description, ("security-user"), $providerName, $providerUserId)
            let $usermapping := oauth2:mapUserToAuthProvider($username, $providerName, $providerUserId, $providerUserData)
            return
                $username
};

(:~
 : Map a MarkLogic user to an auth provider. Create the provider data block
 : with details about the user from the auth provider
 : @param $markLogicUsername the username of the MarkLogic database user in the security database
 : @param $providerName the provider name corresponding to the provider config
 : @param $providerUserId the unique user id from the provider
 : @param $providerUserData node() block representing the user profile data from the provider
 : 
 :)
declare function oauth2:mapUserToAuthProvider($markLogicUsername as xs:string, 
                                              $providerName as xs:string, 
                                              $providerUserId as xs:string,
                                              $providerUserData as node()) 
{
    let $pathToUserDetail := fn:concat("/users/", $markLogicUsername, ".xml")
    let $userDetail := xdmp:unpath($pathToUserDetail)/user
 
    return
        if($userDetail) then
            if($userDetail/provider-data[@name = $providerName]) 
            then
                (
                let $evalStatement := "xquery version '1.0-ml'; 
                                        declare variable $userDetail external;
                                        declare variable $providerName external;
                                        declare variable $providerUserData external;
                                        xdmp:node-replace($userDetail/provider-data[@name = $providerName], $providerUserData)"
                let $eval := xdmp:eval($evalStatement,
                                        (xs:QName("userDetail"), $userDetail,xs:QName("providerName"), $providerName,xs:QName("providerUserData"), $providerUserData),
                                        (<options xmlns="xdmp:eval">
                                          <isolation>different-transaction</isolation>
                                          <prevent-deadlocks>true</prevent-deadlocks>
                                        </options>))
                return $eval
                )
           else
                let $evalStatement := "xquery version '1.0-ml'; 
                                        declare variable $userDetail external;
                                        declare variable $providerUserData external;
                                        xdmp:node-insert-child($userDetail,$providerUserData)"
                let $eval := xdmp:eval($evalStatement,
                                        (xs:QName("userDetail"), $userDetail,xs:QName("providerUserData"), $providerUserData),
                                        (<options xmlns="xdmp:eval">
                                          <isolation>different-transaction</isolation>
                                          <prevent-deadlocks>true</prevent-deadlocks>
                                        </options>))
                return $eval
                
        else
            (
            let $evalStatement := "xquery version '1.0-ml'; 
                                        declare variable $pathToUserDetail external;
                                        declare variable $markLogicUsername external;
                                        declare variable $providerUserData external;
                                        xdmp:document-insert($pathToUserDetail,
                                            element user { 
                                                attribute name { $markLogicUsername },
                                                $providerUserData
                                            },
                                            (xdmp:permission('security-anon', 'read'), xdmp:permission('security-admin', 'update'))
                                            )"
            let $eval := xdmp:eval($evalStatement,
                                    (xs:QName("pathToUserDetail"), $pathToUserDetail,xs:QName("markLogicUsername"), $markLogicUsername,xs:QName("providerUserData"), $providerUserData),
                                    (<options xmlns="xdmp:eval">
                                      <isolation>different-transaction</isolation>
                                      <prevent-deadlocks>true</prevent-deadlocks>
                                    </options>))
            return $eval
            
            )          
};

declare function oauth2:loginAsMarkLogicUser($username) 
{
    xdmp:eval(
        fn:concat("xquery version '1.0-ml'; xdmp:login('", $username, "')")    
    )
};</textarea>
</form>

<p>Press <strong>ctrl-space, ':', '$'</strong> to activate autocompletion for variables (let, variable, for, module) and functions (<strong>oauth2:, map:,xdmp:</strong>). See
the code (<a href="../addon/hint/show-hint.js">here</a>
and <a href="../addon/hint/xquery/xquery-hint.js">here</a>) to figure out
how it works.</p>

    <script>
      
      // completion for xdmp module
      CodeMirror.defineXQueryModule({"prefix":"xdmp","namespace":"http://marklogic.com/xdmp","functions":[{"name":"access","as":"xs:boolean","params":[{"name":"uri","as":"xs:string"},{"name":"action","as":"xs:string"}]},{"name":"add-response-header","as":"empty-sequence()","params":[{"name":"name","as":"xs:string"},{"name":"value","as":"xs:string"}]},{"name":"amp","as":"xs:integer","params":[{"name":"namespace","as":"xs:string"},{"name":"localname","as":"xs:string"},{"name":"module-uri","as":"xs:string"},{"name":"database","as":"xs:unsignedLong"}]},{"name":"amp-roles","as":"xs:unsignedLong*","params":[{"name":"namespace-uri","as":"xs:string"},{"name":"localname","as":"xs:string"},{"name":"document-uri","as":"xs:string"},{"name":"database-id","as":"xs:unsignedLong"}]},{"name":"apply","as":"item()*","params":[{"name":"function","as":"xdmp:function"}]},{"name":"apply","as":"item()*","params":[{"name":"function","as":"xdmp:function"},{"name":"params-1-to-N","as":"item()*"}]},{"name":"architecture","as":"xs:string"},{"name":"base64-decode","as":"xs:string","params":[{"name":"encoded","as":"xs:string"}]},{"name":"base64-encode","as":"xs:string","params":[{"name":"plaintext","as":"xs:string"}]},{"name":"can-grant-roles","as":"empty-sequence()","params":[{"name":"roles","as":"xs:string*"}]},{"name":"castable-as","as":"xs:boolean","params":[{"name":"namespace-uri","as":"xs:string"},{"name":"local-name","as":"xs:string"},{"name":"item","as":"item()"}]},{"name":"collation-canonical-uri","as":"xs:string","params":[{"name":"collation-uri","as":"xs:string"}]},{"name":"collection-delete","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"}]},{"name":"collection-locks","as":"document-node()*","params":[{"name":"uri","as":"xs:string*"}]},{"name":"collection-locks","as":"document-node()*"},{"name":"collection-properties","as":"document-node()*","params":[{"name":"uri","as":"xs:string*"}]},{"name":"collection-properties","as":"document-node()*"},{"name":"database","as":"xs:unsignedLong","params":[{"name":"name","as":"xs:string"}]},{"name":"database","as":"xs:unsignedLong"},{"name":"database-backup","as":"xs:unsignedLong","params":[{"name":"forestIDs","as":"unsignedLong*"},{"name":"pathname","as":"xs:string"}]},{"name":"database-backup-cancel","as":"xs:boolean","params":[{"name":"jobid","as":"unsignedLong"}]},{"name":"database-backup-purge","as":"empty-sequence()","params":[{"name":"dir","as":"xs:string"},{"name":"keep-num-backups","as":"xs:unsignedLong"}]},{"name":"database-backup-status","as":"element()","params":[{"name":"jobid","as":"unsignedLong"}]},{"name":"database-backup-status","as":"element()","params":[{"name":"jobid","as":"unsignedLong"},{"name":"hostid","as":"unsignedLong"}]},{"name":"database-backup-validate","as":"element()","params":[{"name":"forestIDs","as":"unsignedLong*"},{"name":"pathname","as":"xs:string"}]},{"name":"database-forests","as":"xs:unsignedLong*","params":[{"name":"database","as":"xs:unsignedLong"}]},{"name":"database-name","as":"xs:string","params":[{"name":"id","as":"xs:unsignedLong"}]},{"name":"database-restore","as":"xs:unsignedLong","params":[{"name":"forestIDs","as":"unsignedLong*"},{"name":"pathname","as":"xs:string"}]},{"name":"database-restore","as":"xs:unsignedLong","params":[{"name":"forestIDs","as":"unsignedLong*"},{"name":"pathname","as":"xs:string"},{"name":"restoreToTime","as":"xs:dateTime?"}]},{"name":"database-restore-cancel","as":"xs:boolean","params":[{"name":"jobid","as":"unsignedLong"}]},{"name":"database-restore-status","as":"element()","params":[{"name":"jobid","as":"unsignedLong"}]},{"name":"database-restore-validate","as":"element()","params":[{"name":"forestIDs","as":"unsignedLong*"},{"name":"pathname","as":"xs:string"}]},{"name":"database-restore-validate","as":"element()","params":[{"name":"forestIDs","as":"unsignedLong*"},{"name":"pathname","as":"xs:string"},{"name":"restoreToTime","as":"xs:dateTime"}]},{"name":"databases","as":"xs:unsignedLong*"},{"name":"default-collections","as":"element()*","params":[{"name":"uri","as":"xs:string"}]},{"name":"default-collections","as":"element()*"},{"name":"default-permissions","as":"element()*","params":[{"name":"uri","as":"xs:string"}]},{"name":"default-permissions","as":"element()*"},{"name":"describe","as":"xs:string","params":[{"name":"item","as":"item()*"}]},{"name":"describe","as":"xs:string","params":[{"name":"item","as":"item()*"},{"name":"maxSequenceLength","as":"xs:unsignedInt?"}]},{"name":"describe","as":"xs:string","params":[{"name":"item","as":"item()*"},{"name":"maxSequenceLength","as":"xs:unsignedInt?"},{"name":"maxItemLength","as":"xs:unsignedInt*"}]},{"name":"diacritic-less","as":"xs:string","params":[{"name":"string","as":"xs:string"}]},{"name":"directory","as":"document-node()*","params":[{"name":"uri","as":"xs:string*"}]},{"name":"directory","as":"document-node()*","params":[{"name":"uri","as":"xs:string*"},{"name":"depth","as":"xs:string?"}]},{"name":"directory-create","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"}]},{"name":"directory-create","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"permissions","as":"element(sec:permission)*"}]},{"name":"directory-create","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"permissions","as":"element(sec:permission)*"},{"name":"collections","as":"xs:string*"}]},{"name":"directory-create","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"permissions","as":"element(sec:permission)*"},{"name":"collections","as":"xs:string*"},{"name":"quality","as":"xs:int?"}]},{"name":"directory-create","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"permissions","as":"element(sec:permission)*"},{"name":"collections","as":"xs:string*"},{"name":"quality","as":"xs:int?"},{"name":"forest-ids","as":"xs:unsignedLong*"}]},{"name":"directory-delete","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"}]},{"name":"directory-locks","as":"document-node()*","params":[{"name":"uri","as":"xs:string*"}]},{"name":"directory-locks","as":"document-node()*","params":[{"name":"uri","as":"xs:string*"},{"name":"depth","as":"xs:string?"}]},{"name":"directory-properties","as":"document-node()*","params":[{"name":"uri","as":"xs:string"}]},{"name":"directory-properties","as":"document-node()*","params":[{"name":"uri","as":"xs:string"},{"name":"depth","as":"xs:string?"}]},{"name":"document-add-collections","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"collections","as":"xs:string*"}]},{"name":"document-add-permissions","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"permissions","as":"element(sec:permission)*"}]},{"name":"document-add-properties","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"props","as":"element()*"}]},{"name":"document-delete","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"}]},{"name":"document-forest","as":"xs:integer?","params":[{"name":"uri","as":"xs:string"}]},{"name":"document-forest","as":"xs:integer?","params":[{"name":"uri","as":"xs:string"},{"name":"forest-ids","as":"xs:unsignedLong*"}]},{"name":"document-get","as":"node()","params":[{"name":"location","as":"xs:string"}]},{"name":"document-get","as":"node()","params":[{"name":"location","as":"xs:string"},{"name":"options","as":"node()?"}]},{"name":"document-get-collections","as":"xs:string*","params":[{"name":"uri","as":"xs:string"}]},{"name":"document-get-permissions","as":"element()*","params":[{"name":"uri","as":"xs:string"}]},{"name":"document-get-properties","as":"element()*","params":[{"name":"uri","as":"xs:string"},{"name":"property","as":"xs:QName"}]},{"name":"document-get-quality","as":"xs:integer?","params":[{"name":"uri","as":"xs:string"}]},{"name":"document-insert","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"root","as":"node()"}]},{"name":"document-insert","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"root","as":"node()"},{"name":"permissions","as":"element(sec:permission)*"}]},{"name":"document-insert","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"root","as":"node()"},{"name":"permissions","as":"element(sec:permission)*"},{"name":"collections","as":"xs:string*"}]},{"name":"document-insert","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"root","as":"node()"},{"name":"permissions","as":"element(sec:permission)*"},{"name":"collections","as":"xs:string*"},{"name":"quality","as":"xs:int?"}]},{"name":"document-insert","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"root","as":"node()"},{"name":"permissions","as":"element(sec:permission)*"},{"name":"collections","as":"xs:string*"},{"name":"quality","as":"xs:int?"},{"name":"forest-ids","as":"xs:unsignedLong*"}]},{"name":"document-load","as":"empty-sequence()","params":[{"name":"location","as":"xs:string"}]},{"name":"document-load","as":"empty-sequence()","params":[{"name":"location","as":"xs:string"},{"name":"options","as":"node()?"}]},{"name":"document-locks","as":"document-node()*","params":[{"name":"uri","as":"xs:string*"}]},{"name":"document-locks","as":"document-node()*"},{"name":"document-properties","as":"document-node()*","params":[{"name":"uri","as":"xs:string*"}]},{"name":"document-properties","as":"document-node()*"},{"name":"document-remove-collections","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"collections","as":"xs:string*"}]},{"name":"document-remove-permissions","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"permissions","as":"element(sec:permission)*"}]},{"name":"document-remove-properties","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"property-names","as":"xs:QName*"}]},{"name":"document-set-collections","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"collections","as":"xs:string*"}]},{"name":"document-set-permissions","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"permissions","as":"element(sec:permission)*"}]},{"name":"document-set-properties","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"props","as":"element()*"}]},{"name":"document-set-property","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"prop","as":"element()"}]},{"name":"document-set-quality","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"quality","as":"xs:int"}]},{"name":"elapsed-time","as":"xs:dayTimeDuration"},{"name":"element-content-type","as":"xs:string","params":[{"name":"element","as":"element()"}]},{"name":"email","as":"empty-sequence()","params":[{"name":"message","as":"node()"}]},{"name":"estimate","as":"xs:integer","params":[{"name":"expression","as":"item()*"}]},{"name":"estimate","as":"xs:integer","params":[{"name":"expression","as":"item()*"},{"name":"maximum","as":"xs:double?"}]},{"name":"eval","as":"item()*","params":[{"name":"xquery","as":"xs:string"}]},{"name":"eval","as":"item()*","params":[{"name":"xquery","as":"xs:string"},{"name":"vars","as":"item()*"}]},{"name":"eval","as":"item()*","params":[{"name":"xquery","as":"xs:string"},{"name":"vars","as":"item()*"},{"name":"options","as":"node()?"}]},{"name":"eval-in","as":"item()*","params":[{"name":"xquery","as":"xs:string"},{"name":"ID","as":"xs:unsignedLong"}]},{"name":"eval-in","as":"item()*","params":[{"name":"xquery","as":"xs:string"},{"name":"ID","as":"xs:unsignedLong"},{"name":"vars","as":"item()*"}]},{"name":"eval-in","as":"item()*","params":[{"name":"xquery","as":"xs:string"},{"name":"ID","as":"xs:unsignedLong"},{"name":"vars","as":"item()*"},{"name":"modules","as":"xs:unsignedLong?"}]},{"name":"eval-in","as":"item()*","params":[{"name":"xquery","as":"xs:string"},{"name":"ID","as":"xs:unsignedLong"},{"name":"vars","as":"item()*"},{"name":"modules","as":"xs:unsignedLong?"},{"name":"root","as":"xs:string?"}]},{"name":"excel-convert","as":"node()*","params":[{"name":"doc","as":"node()"},{"name":"filename","as":"xs:string"}]},{"name":"excel-convert","as":"node()*","params":[{"name":"doc","as":"node()"},{"name":"filename","as":"xs:string"},{"name":"options","as":"node()?"}]},{"name":"exists","as":"xs:integer","params":[{"name":"expression","as":"item()*"}]},{"name":"filesystem-directory","as":"element(dir:directory)","params":[{"name":"pathname","as":"xs:string"}]},{"name":"filesystem-file","as":"xs:string","params":[{"name":"pathname","as":"xs:string"}]},{"name":"forest","as":"xs:unsignedLong","params":[{"name":"name","as":"xs:string"}]},{"name":"forest-backup","as":"empty-sequence()","params":[{"name":"forestID","as":"unsignedLong"},{"name":"pathname","as":"xs:string"}]},{"name":"forest-clear","as":"empty-sequence()","params":[{"name":"forestIDs","as":"unsignedLong*"}]},{"name":"forest-counts","as":"element(forest-counts)","params":[{"name":"forest-id","as":"xs:unsignedLong"}]},{"name":"forest-counts","as":"element(forest-counts)","params":[{"name":"forest-id","as":"xs:unsignedLong"},{"name":"show-elements","as":"xs:string*"}]},{"name":"forest-databases","as":"xs:unsignedLong","params":[{"name":"forest","as":"xs:unsignedLong"}]},{"name":"forest-name","as":"xs:string","params":[{"name":"id","as":"xs:unsignedLong"}]},{"name":"forest-restart","as":"empty-sequence()","params":[{"name":"forestID","as":"unsignedLong"}]},{"name":"forest-restore","as":"empty-sequence()","params":[{"name":"forestID","as":"unsignedLong"},{"name":"pathname","as":"xs:string"}]},{"name":"forest-status","as":"element(forest-status)","params":[{"name":"forest-id","as":"xs:unsignedLong"}]},{"name":"forests","as":"xs:unsignedLong*"},{"name":"from-json","as":"item()*","params":[{"name":"arg","as":"xs:string"}]},{"name":"function","as":"xdmp:function","params":[{"name":"function","as":"xs:QName"}]},{"name":"function","as":"xdmp:function","params":[{"name":"function","as":"xs:QName"},{"name":"module-path","as":"xs:string?"}]},{"name":"function-module","as":"xs:string","params":[{"name":"function","as":"xdmp:function"}]},{"name":"function-name","as":"xs:QName","params":[{"name":"function","as":"xdmp:function"}]},{"name":"get","as":"node()","params":[{"name":"path","as":"xs:string"}]},{"name":"get","as":"node()","params":[{"name":"path","as":"xs:string"},{"name":"default-namespace","as":"xs:string?"}]},{"name":"get","as":"node()","params":[{"name":"path","as":"xs:string"},{"name":"default-namespace","as":"xs:string?"},{"name":"options","as":"xs:string*"}]},{"name":"get-current-roles","as":"xs:unsignedLong*"},{"name":"get-current-user","as":"xs:string"},{"name":"get-request-body","as":"item()*","params":[{"name":"format","as":"xs:string?"}]},{"name":"get-request-body","as":"item()*"},{"name":"get-request-client-address","as":"xs:string?"},{"name":"get-request-client-certificate","as":"xs:string?"},{"name":"get-request-field","as":"xs:string*","params":[{"name":"name","as":"xs:string"}]},{"name":"get-request-field","as":"xs:string*","params":[{"name":"name","as":"xs:string"},{"name":"default","as":"xs:string?"}]},{"name":"get-request-field-content-type","as":"xs:string*","params":[{"name":"field-name","as":"xs:string"}]},{"name":"get-request-field-filename","as":"xs:string*","params":[{"name":"field-name","as":"xs:string"}]},{"name":"get-request-field-names","as":"xs:string*"},{"name":"get-request-header","as":"xs:string*","params":[{"name":"name","as":"xs:string"}]},{"name":"get-request-header","as":"xs:string*","params":[{"name":"name","as":"xs:string"},{"name":"default","as":"xs:string?"}]},{"name":"get-request-header-names","as":"xs:string*"},{"name":"get-request-method","as":"xs:string"},{"name":"get-request-path","as":"xs:string"},{"name":"get-request-protocol","as":"xs:string?"},{"name":"get-request-url","as":"xs:string"},{"name":"get-request-user","as":"xs:unsignedLong"},{"name":"get-request-username","as":"xs:string"},{"name":"get-response-code","as":"item()*"},{"name":"get-response-encoding","as":"xs:string"},{"name":"get-session-field","as":"item()*","params":[{"name":"name","as":"xs:string"}]},{"name":"get-session-field","as":"item()*","params":[{"name":"name","as":"xs:string"},{"name":"default","as":"item()*"}]},{"name":"get-session-field-names","as":"xs:string*"},{"name":"group","as":"xs:unsignedLong","params":[{"name":"name","as":"xs:string"}]},{"name":"group","as":"xs:unsignedLong"},{"name":"group-hosts","as":"xs:unsignedLong*","params":[{"name":"name","as":"xs:unsignedLong"}]},{"name":"group-hosts","as":"xs:unsignedLong*"},{"name":"group-name","as":"xs:string","params":[{"name":"name","as":"xs:unsignedLong"}]},{"name":"group-name","as":"xs:string"},{"name":"group-servers","as":"xs:unsignedLong*","params":[{"name":"name","as":"xs:unsignedLong"}]},{"name":"group-servers","as":"xs:unsignedLong*"},{"name":"groups","as":"xs:unsignedLong*"},{"name":"has-privilege","as":"xs:boolean","params":[{"name":"privileges","as":"xs:string*"},{"name":"kind","as":"xs:string"}]},{"name":"hash32","as":"xs:unsignedInt","params":[{"name":"string","as":"xs:string"}]},{"name":"hash64","as":"xs:unsignedLong","params":[{"name":"string","as":"xs:string"}]},{"name":"hex-to-integer","as":"xs:integer","params":[{"name":"hex","as":"xs:string"}]},{"name":"host","as":"xs:unsignedLong","params":[{"name":"name","as":"xs:string"}]},{"name":"host","as":"xs:unsignedLong"},{"name":"host-name","as":"xs:string","params":[{"name":"ID","as":"xs:unsignedLong"}]},{"name":"host-status","as":"element(host-status)","params":[{"name":"host-id","as":"xs:unsignedLong"}]},{"name":"hosts","as":"xs:unsignedLong*"},{"name":"http-delete","as":"item()+","params":[{"name":"uri","as":"xs:string"}]},{"name":"http-delete","as":"item()+","params":[{"name":"uri","as":"xs:string"},{"name":"options","as":"node()?"}]},{"name":"http-get","as":"item()+","params":[{"name":"uri","as":"xs:string"}]},{"name":"http-get","as":"item()+","params":[{"name":"uri","as":"xs:string"},{"name":"options","as":"node()?"}]},{"name":"http-head","as":"item()+","params":[{"name":"uri","as":"xs:string"}]},{"name":"http-head","as":"item()+","params":[{"name":"uri","as":"xs:string"},{"name":"options","as":"node()?"}]},{"name":"http-options","as":"item()+","params":[{"name":"uri","as":"xs:string"}]},{"name":"http-options","as":"item()+","params":[{"name":"uri","as":"xs:string"},{"name":"options","as":"node()?"}]},{"name":"http-post","as":"item()+","params":[{"name":"uri","as":"xs:string"}]},{"name":"http-post","as":"item()+","params":[{"name":"uri","as":"xs:string"},{"name":"options","as":"node()?"}]},{"name":"http-put","as":"item()+","params":[{"name":"uri","as":"xs:string"}]},{"name":"http-put","as":"item()+","params":[{"name":"uri","as":"xs:string"},{"name":"options","as":"node()?"}]},{"name":"integer-to-hex","as":"xs:string","params":[{"name":"val","as":"xs:integer"}]},{"name":"integer-to-octal","as":"xs:string","params":[{"name":"val","as":"xs:integer"}]},{"name":"invoke","as":"item()*","params":[{"name":"path","as":"xs:string"}]},{"name":"invoke","as":"item()*","params":[{"name":"path","as":"xs:string"},{"name":"vars","as":"item()*"}]},{"name":"invoke","as":"item()*","params":[{"name":"path","as":"xs:string"},{"name":"vars","as":"item()*"},{"name":"options","as":"node()?"}]},{"name":"invoke-in","as":"item()*","params":[{"name":"uri","as":"xs:string"},{"name":"ID","as":"xs:unsignedLong"}]},{"name":"invoke-in","as":"item()*","params":[{"name":"uri","as":"xs:string"},{"name":"ID","as":"xs:unsignedLong"},{"name":"vars","as":"item()*"}]},{"name":"invoke-in","as":"item()*","params":[{"name":"uri","as":"xs:string"},{"name":"ID","as":"xs:unsignedLong"},{"name":"vars","as":"item()*"},{"name":"modules","as":"xs:unsignedLong?"}]},{"name":"invoke-in","as":"item()*","params":[{"name":"uri","as":"xs:string"},{"name":"ID","as":"xs:unsignedLong"},{"name":"vars","as":"item()*"},{"name":"modules","as":"xs:unsignedLong?"},{"name":"root","as":"xs:string?"}]},{"name":"load","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"}]},{"name":"load","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"},{"name":"uri","as":"xs:string?"}]},{"name":"load","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"},{"name":"uri","as":"xs:string?"},{"name":"permissions","as":"element(sec:permission)*"}]},{"name":"load","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"},{"name":"uri","as":"xs:string?"},{"name":"permissions","as":"element(sec:permission)*"},{"name":"collections","as":"xs:string*"}]},{"name":"load","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"},{"name":"uri","as":"xs:string?"},{"name":"permissions","as":"element(sec:permission)*"},{"name":"collections","as":"xs:string*"},{"name":"quality","as":"xs:int?"}]},{"name":"load","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"},{"name":"uri","as":"xs:string?"},{"name":"permissions","as":"element(sec:permission)*"},{"name":"collections","as":"xs:string*"},{"name":"quality","as":"xs:int?"},{"name":"default-namespace","as":"xs:string?"}]},{"name":"load","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"},{"name":"uri","as":"xs:string?"},{"name":"permissions","as":"element(sec:permission)*"},{"name":"collections","as":"xs:string*"},{"name":"quality","as":"xs:int?"},{"name":"default-namespace","as":"xs:string?"},{"name":"options","as":"xs:string*"}]},{"name":"load","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"},{"name":"uri","as":"xs:string?"},{"name":"permissions","as":"element(sec:permission)*"},{"name":"collections","as":"xs:string*"},{"name":"quality","as":"xs:int?"},{"name":"default-namespace","as":"xs:string?"},{"name":"options","as":"xs:string*"},{"name":"forest-ids","as":"xs:unsignedLong*"}]},{"name":"lock-acquire","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"}]},{"name":"lock-acquire","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"scope","as":"xs:string?"}]},{"name":"lock-acquire","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"scope","as":"xs:string?"},{"name":"depth","as":"xs:string?"}]},{"name":"lock-acquire","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"scope","as":"xs:string?"},{"name":"depth","as":"xs:string?"},{"name":"owner","as":"item()?"}]},{"name":"lock-acquire","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"},{"name":"scope","as":"xs:string?"},{"name":"depth","as":"xs:string?"},{"name":"owner","as":"item()?"},{"name":"timeout","as":"xs:unsignedLong?"}]},{"name":"lock-release","as":"empty-sequence()","params":[{"name":"uri","as":"xs:string"}]},{"name":"log","as":"empty-sequence()","params":[{"name":"msg","as":"item()*"}]},{"name":"log","as":"empty-sequence()","params":[{"name":"msg","as":"item()*"},{"name":"level","as":"xs:string?"}]},{"name":"log-level","as":"xs:string"},{"name":"login","as":"xs:boolean","params":[{"name":"name","as":"xs:string"}]},{"name":"login","as":"xs:boolean","params":[{"name":"name","as":"xs:string"},{"name":"password","as":"xs:string?"}]},{"name":"login","as":"xs:boolean","params":[{"name":"name","as":"xs:string"},{"name":"password","as":"xs:string?"},{"name":"set-session","as":"xs:boolean?"}]},{"name":"logout","as":"empty-sequence()"},{"name":"md5","as":"xs:string","params":[{"name":"encoded","as":"xs:string"}]},{"name":"merge","as":"empty-sequence()","params":[{"name":"options","as":"node()?"}]},{"name":"merge","as":"empty-sequence()"},{"name":"merge-cancel","as":"empty-sequence()","params":[{"name":"forest-ID","as":"xs:unsignedLong"},{"name":"merge-ID","as":"xs:unsignedLong"}]},{"name":"merging","as":"xs:unsignedLong*"},{"name":"modules-database","as":"xs:unsignedLong"},{"name":"modules-root","as":"xs:string"},{"name":"node-database","as":"xs:unsignedLong?","params":[{"name":"node","as":"node()"}]},{"name":"node-delete","as":"empty-sequence()","params":[{"name":"old","as":"node()"}]},{"name":"node-insert-after","as":"empty-sequence()","params":[{"name":"sibling","as":"node()"},{"name":"new","as":"node()"}]},{"name":"node-insert-before","as":"empty-sequence()","params":[{"name":"sibling","as":"node()"},{"name":"new","as":"node()"}]},{"name":"node-insert-child","as":"empty-sequence()","params":[{"name":"parent","as":"node()"},{"name":"new","as":"node()"}]},{"name":"node-kind","as":"xs:string","params":[{"name":"node","as":"node()?"}]},{"name":"node-replace","as":"empty-sequence()","params":[{"name":"old","as":"node()"},{"name":"new","as":"node()"}]},{"name":"node-uri","as":"xs:string?","params":[{"name":"node","as":"node()"}]},{"name":"octal-to-integer","as":"xs:integer","params":[{"name":"octal","as":"xs:string"}]},{"name":"path","as":"xs:string","params":[{"name":"node","as":"node()"}]},{"name":"path","as":"xs:string","params":[{"name":"node","as":"node()"},{"name":"include-document","as":"xs:boolean?"}]},{"name":"pdf-convert","as":"node()*","params":[{"name":"doc","as":"node()"},{"name":"filename","as":"xs:string"}]},{"name":"pdf-convert","as":"node()*","params":[{"name":"doc","as":"node()"},{"name":"filename","as":"xs:string"},{"name":"options","as":"node()?"}]},{"name":"permission","as":"element()","params":[{"name":"role","as":"xs:string"},{"name":"capability","as":"xs:string"}]},{"name":"platform","as":"xs:string"},{"name":"powerpoint-convert","as":"node()*","params":[{"name":"doc","as":"node()"},{"name":"filename","as":"xs:string"}]},{"name":"powerpoint-convert","as":"node()*","params":[{"name":"doc","as":"node()"},{"name":"filename","as":"xs:string"},{"name":"options","as":"node()?"}]},{"name":"pretty-print","as":"xs:string","params":[{"name":"xquery","as":"xs:string"}]},{"name":"privilege","as":"xs:integer","params":[{"name":"action","as":"xs:string"},{"name":"kind","as":"xs:string"}]},{"name":"privilege-roles","as":"xs:unsignedLong*","params":[{"name":"action","as":"xs:string"},{"name":"kind","as":"xs:string"}]},{"name":"product-edition","as":"xs:string"},{"name":"query-meters","as":"element()"},{"name":"query-trace","as":"empty-sequence()","params":[{"name":"enabled","as":"xs:boolean"}]},{"name":"quote","as":"xs:string","params":[{"name":"arg","as":"item()*"}]},{"name":"quote","as":"xs:string","params":[{"name":"arg","as":"item()*"},{"name":"options","as":"node()?"}]},{"name":"random","as":"xs:unsignedLong","params":[{"name":"max","as":"xs:unsignedLong"}]},{"name":"random","as":"xs:unsignedLong"},{"name":"redirect-response","as":"empty-sequence()","params":[{"name":"name","as":"xs:string"}]},{"name":"request","as":"xs:unsignedLong"},{"name":"request-cancel","as":"empty-sequence()","params":[{"name":"hostID","as":"xs:unsignedLong"},{"name":"serverID","as":"xs:unsignedLong"},{"name":"requestID","as":"xs:unsignedLong"}]},{"name":"request-status","as":"element(request-status)","params":[{"name":"host-id","as":"xs:unsignedLong"},{"name":"server-id","as":"xs:unsignedLong"},{"name":"request-id","as":"xs:unsignedLong"}]},{"name":"request-timestamp","as":"xs:unsignedLong?"},{"name":"restart","as":"empty-sequence()","params":[{"name":"hostIDs","as":"unsignedLong*"},{"name":"reason","as":"xs:string"}]},{"name":"rethrow","as":"empty-sequence()"},{"name":"role","as":"xs:integer","params":[{"name":"role","as":"xs:string"}]},{"name":"role-roles","as":"xs:unsignedLong*","params":[{"name":"name","as":"xs:string"}]},{"name":"save","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"},{"name":"node","as":"node()"}]},{"name":"save","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"},{"name":"node","as":"node()"},{"name":"options","as":"node()?"}]},{"name":"schema-database","as":"xs:unsignedLong"},{"name":"security-assert","as":"empty-sequence()","params":[{"name":"privileges","as":"xs:string*"},{"name":"kind","as":"xs:string"}]},{"name":"security-database","as":"xs:unsignedLong"},{"name":"server","as":"xs:unsignedLong+","params":[{"name":"name","as":"xs:string"}]},{"name":"server","as":"xs:unsignedLong+"},{"name":"server-name","as":"xs:string","params":[{"name":"id","as":"xs:unsignedLong"}]},{"name":"server-status","as":"element(server-status)","params":[{"name":"host-id","as":"xs:unsignedLong"},{"name":"server-id","as":"xs:unsignedLong"}]},{"name":"servers","as":"xs:unsignedLong*"},{"name":"set","as":"empty-sequence()","params":[{"name":"variable","as":"item()*"},{"name":"expr","as":"item()*"}]},{"name":"set-request-time-limit","as":"empty-sequence()","params":[{"name":"time-limit","as":"xs:unsignedInt"}]},{"name":"set-request-time-limit","as":"empty-sequence()","params":[{"name":"time-limit","as":"xs:unsignedInt"},{"name":"hostID","as":"xs:unsignedLong?"}]},{"name":"set-request-time-limit","as":"empty-sequence()","params":[{"name":"time-limit","as":"xs:unsignedInt"},{"name":"hostID","as":"xs:unsignedLong?"},{"name":"serverID","as":"xs:unsignedLong?"}]},{"name":"set-request-time-limit","as":"empty-sequence()","params":[{"name":"time-limit","as":"xs:unsignedInt"},{"name":"hostID","as":"xs:unsignedLong?"},{"name":"serverID","as":"xs:unsignedLong?"},{"name":"requestID","as":"xs:unsignedLong?"}]},{"name":"set-response-code","as":"empty-sequence()","params":[{"name":"code","as":"xs:integer"},{"name":"message","as":"xs:string"}]},{"name":"set-response-content-type","as":"empty-sequence()","params":[{"name":"name","as":"xs:string"}]},{"name":"set-response-encoding","as":"empty-sequence()","params":[{"name":"encoding","as":"xs:string"}]},{"name":"set-session-field","as":"item()*","params":[{"name":"name","as":"xs:string"},{"name":"value","as":"item()*"}]},{"name":"shutdown","as":"empty-sequence()","params":[{"name":"hostIDs","as":"unsignedLong*"},{"name":"reason","as":"xs:string"}]},{"name":"sleep","as":"empty-sequence()","params":[{"name":"msec","as":"xs:unsignedInt"}]},{"name":"spawn","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"}]},{"name":"spawn","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"},{"name":"vars","as":"item()*"}]},{"name":"spawn","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"},{"name":"vars","as":"item()*"},{"name":"options","as":"node()?"}]},{"name":"spawn-in","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"},{"name":"ID","as":"xs:unsignedLong"}]},{"name":"spawn-in","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"},{"name":"ID","as":"xs:unsignedLong"},{"name":"vars","as":"item()*"}]},{"name":"spawn-in","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"},{"name":"ID","as":"xs:unsignedLong"},{"name":"vars","as":"item()*"},{"name":"modules","as":"xs:unsignedLong?"}]},{"name":"spawn-in","as":"empty-sequence()","params":[{"name":"path","as":"xs:string"},{"name":"ID","as":"xs:unsignedLong"},{"name":"vars","as":"item()*"},{"name":"modules","as":"xs:unsignedLong?"},{"name":"root","as":"xs:string?"}]},{"name":"strftime","as":"xs:string","params":[{"name":"format","as":"xs:string"},{"name":"value","as":"xs:dateTime"}]},{"name":"subbinary","as":"binary()","params":[{"name":"source","as":"binary()"},{"name":"starting-location","as":"xs:double"}]},{"name":"subbinary","as":"binary()","params":[{"name":"source","as":"binary()"},{"name":"starting-location","as":"xs:double"},{"name":"length","as":"xs:double"}]},{"name":"tidy","as":"node()+","params":[{"name":"doc","as":"xs:string"}]},{"name":"tidy","as":"node()+","params":[{"name":"doc","as":"xs:string"},{"name":"options","as":"node()?"}]},{"name":"to-json","as":"xs:string","params":[{"name":"item","as":"item()*"}]},{"name":"trace","as":"empty-sequence()","params":[{"name":"name","as":"xs:string"},{"name":"value","as":"item()*"}]},{"name":"triggers-database","as":"xs:unsignedLong"},{"name":"unpath","as":"item()*","params":[{"name":"expr","as":"xs:string"}]},{"name":"unquote","as":"document-node()+","params":[{"name":"arg","as":"xs:string"}]},{"name":"unquote","as":"document-node()+","params":[{"name":"arg","as":"xs:string"},{"name":"default-namespace","as":"xs:string?"}]},{"name":"unquote","as":"document-node()+","params":[{"name":"arg","as":"xs:string"},{"name":"default-namespace","as":"xs:string?"},{"name":"options","as":"xs:string*"}]},{"name":"uri-content-type","as":"xs:string","params":[{"name":"uri","as":"xs:string"}]},{"name":"uri-format","as":"xs:string","params":[{"name":"uri","as":"xs:string"}]},{"name":"uri-is-file","as":"xs:boolean?","params":[{"name":"uri","as":"xs:string"}]},{"name":"url-decode","as":"xs:string","params":[{"name":"encoded","as":"xs:string"}]},{"name":"url-encode","as":"xs:string","params":[{"name":"plaintext","as":"xs:string"}]},{"name":"url-encode","as":"xs:string","params":[{"name":"plaintext","as":"xs:string"},{"name":"noSpacePlus","as":"xs:boolean?"}]},{"name":"user","as":"xs:integer","params":[{"name":"user","as":"xs:string"}]},{"name":"user-last-login","as":"element(last-login)?","params":[{"name":"user","as":"xs:unsignedLong"}]},{"name":"user-roles","as":"xs:unsignedLong*","params":[{"name":"name","as":"xs:string"}]},{"name":"value","as":"item()*","params":[{"name":"expr","as":"xs:string"}]},{"name":"version","as":"xs:string"},{"name":"with-namespaces","as":"item()*","params":[{"name":"nsbindings","as":"xs:string*"},{"name":"expr","as":"item()*"}]},{"name":"word-convert","as":"node()*","params":[{"name":"doc","as":"node()"},{"name":"filename","as":"xs:string"}]},{"name":"word-convert","as":"node()*","params":[{"name":"doc","as":"node()"},{"name":"filename","as":"xs:string"},{"name":"options","as":"node()?"}]},{"name":"xquery-version","as":"xs:string"},{"name":"zip-create","as":"binary()","params":[{"name":"manifest","as":"node()"},{"name":"nodes","as":"node()+"}]},{"name":"zip-get","as":"node()+","params":[{"name":"zipfile","as":"binary()"},{"name":"name","as":"xs:string"}]},{"name":"zip-get","as":"node()+","params":[{"name":"zipfile","as":"binary()"},{"name":"name","as":"xs:string"},{"name":"options","as":"node()?"}]},{"name":"zip-manifest","as":"node()external;","params":[{"name":"zipfile","as":"binary()"}]}]});
      // completion for map module
      CodeMirror.defineXQueryModule({"prefix":"map","namespace":"http://marklogic.com/xdmp/map","functions":[{"name":"clear","as":"empty-sequence()","params":[{"name":"map","as":"map:map"}]},{"name":"count","as":"xs:unsignedInt","params":[{"name":"map","as":"map:map"}]},{"name":"delete","as":"empty-sequence()","params":[{"name":"map","as":"map:map"},{"name":"key","as":"xs:string"}]},{"name":"get","as":"item()*","params":[{"name":"map","as":"map:map"},{"name":"key","as":"xs:string"}]},{"name":"keys","as":"xs:string*","params":[{"name":"map","as":"map:map"}]},{"name":"map","as":"map:map","params":[{"name":"map","as":"element(map:map)"}]},{"name":"map","as":"map:map"},{"name":"put","as":"empty-sequence()","params":[{"name":"map","as":"map:map"},{"name":"key","as":"xs:string"},{"name":"value","as":"item()*"}]}]});
      
      function passAndHint(cm) {
     	setTimeout(function() {cm.execCommand("autocomplete");}, 100);
      	return CodeMirror.Pass;
      }
          
      CodeMirror.commands.autocomplete = function(cm) {
        CodeMirror.showHint(cm, CodeMirror.xqueryHint);
      }
      var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        lineNumbers: true,
        theme: "xq-light",
        trackContext: true,
        extraKeys: {
            "':'": passAndHint,
            "'$'": passAndHint,
            "Ctrl-Space": "autocomplete"
        }
      });
    </script>
  </body>
</html>
