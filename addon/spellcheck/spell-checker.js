!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";var t=function(e,t,r,n){if(n=n||{},this.platform=n.platform||"chrome",this.dictionary=null,this.rules={},this.dictionaryTable={},this.compoundRules=[],this.compoundRuleCodes={},this.replacementTable=[],this.flags=n.flags||{},e){if(this.dictionary=e,"chrome"==this.platform)t||(t=this._readFile(chrome.extension.getURL("lib/typo/dictionaries/"+e+"/"+e+".aff"))),r||(r=this._readFile(chrome.extension.getURL("lib/typo/dictionaries/"+e+"/"+e+".dic")));else{var s=n.dictionaryPath||"";t||(t=this._readFile(s+"/"+e+"/"+e+".aff")),r||(r=this._readFile(s+"/"+e+"/"+e+".dic"))}this.rules=this._parseAFF(t),this.compoundRuleCodes={};for(var i=0,o=this.compoundRules.length;o>i;i++)for(var a=this.compoundRules[i],l=0,h=a.length;h>l;l++)this.compoundRuleCodes[a[l]]=[];"ONLYINCOMPOUND"in this.flags&&(this.compoundRuleCodes[this.flags.ONLYINCOMPOUND]=[]),this.dictionaryTable=this._parseDIC(r);for(var i in this.compoundRuleCodes)0==this.compoundRuleCodes[i].length&&delete this.compoundRuleCodes[i];for(var i=0,o=this.compoundRules.length;o>i;i++){for(var u=this.compoundRules[i],c="",l=0,h=u.length;h>l;l++){var f=u[l];c+=f in this.compoundRuleCodes?"("+this.compoundRuleCodes[f].join("|")+")":f}this.compoundRules[i]=new RegExp(c,"i")}}return this};t.prototype={load:function(e){for(var t in e)this[t]=e[t];return this},_readFile:function(e,t){t||(t="ISO8859-1");var r=new XMLHttpRequest;return r.open("GET",e,!1),r.overrideMimeType&&r.overrideMimeType("text/plain; charset="+t),r.send(null),r.responseText},_parseAFF:function(e){var t={};e=this._removeAffixComments(e);for(var r=e.split("\n"),n=0,s=r.length;s>n;n++){var i=r[n],o=i.split(/\s+/),a=o[0];if("PFX"==a||"SFX"==a){for(var l=o[1],h=o[2],u=parseInt(o[3],10),c=[],f=n+1,p=n+1+u;p>f;f++){var i=r[f],d=i.split(/\s+/),v=d[2],m=d[3].split("/"),g=m[0];"0"===g&&(g="");var C=this.parseRuleCodes(m[1]),R=d[4],b={};b.add=g,C.length>0&&(b.continuationClasses=C),"."!==R&&("SFX"===a?b.match=new RegExp(R+"$"):b.match=new RegExp("^"+R)),"0"!=v&&("SFX"===a?b.remove=new RegExp(v+"$"):b.remove=v),c.push(b)}t[l]={type:a,combineable:"Y"==h,entries:c},n+=u}else if("COMPOUNDRULE"===a){for(var u=parseInt(o[1],10),f=n+1,p=n+1+u;p>f;f++){var i=r[f],d=i.split(/\s+/);this.compoundRules.push(d[1])}n+=u}else if("REP"===a){var d=i.split(/\s+/);3===d.length&&this.replacementTable.push([d[1],d[2]])}else this.flags[a]=o[1]}return t},_removeAffixComments:function(e){return e=e.replace(/#.*$/gm,""),e=e.replace(/^\s\s*/m,"").replace(/\s\s*$/m,""),e=e.replace(/\n{2,}/g,"\n"),e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},_parseDIC:function(e){function t(e,t){e in n&&"object"==typeof n[e]||(n[e]=[]),n[e].push(t)}e=this._removeDicComments(e);for(var r=e.split("\n"),n={},s=1,i=r.length;i>s;s++){var o=r[s],a=o.split("/",2),l=a[0];if(a.length>1){var h=this.parseRuleCodes(a[1]);"NEEDAFFIX"in this.flags&&-1!=h.indexOf(this.flags.NEEDAFFIX)||t(l,h);for(var u=0,c=h.length;c>u;u++){var f=h[u],p=this.rules[f];if(p)for(var d=this._applyRule(l,p),v=0,m=d.length;m>v;v++){var g=d[v];if(t(g,[]),p.combineable)for(var C=u+1;c>C;C++){var R=h[C],b=this.rules[R];if(b&&b.combineable&&p.type!=b.type)for(var y=this._applyRule(g,b),F=0,x=y.length;x>F;F++){var E=y[F];t(E,[])}}}f in this.compoundRuleCodes&&this.compoundRuleCodes[f].push(l)}}else t(l.trim(),[])}return n},_removeDicComments:function(e){return e=e.replace(/^\t.*$/gm,"")},parseRuleCodes:function(e){if(!e)return[];if(!("FLAG"in this.flags))return e.split("");if("long"===this.flags.FLAG){for(var t=[],r=0,n=e.length;n>r;r+=2)t.push(e.substr(r,2));return t}return"num"===this.flags.FLAG?textCode.split(","):void 0},_applyRule:function(e,t){for(var r=t.entries,n=[],s=0,i=r.length;i>s;s++){var o=r[s];if(!o.match||e.match(o.match)){var a=e;if(o.remove&&(a=a.replace(o.remove,"")),"SFX"===t.type?a+=o.add:a=o.add+a,n.push(a),"continuationClasses"in o)for(var l=0,h=o.continuationClasses.length;h>l;l++){var u=this.rules[o.continuationClasses[l]];u&&(n=n.concat(this._applyRule(a,u)))}}}return n},check:function(e){var t=e.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(this.checkExact(t))return!0;if(t.toUpperCase()===t){var r=t[0]+t.substring(1).toLowerCase();if(this.hasFlag(r,"KEEPCASE"))return!1;if(this.checkExact(r))return!0}var n=t.toLowerCase();if(n!==t){if(this.hasFlag(n,"KEEPCASE"))return!1;if(this.checkExact(n))return!0}return!1},checkExact:function(e){var t=this.dictionaryTable[e];if("undefined"==typeof t){if("COMPOUNDMIN"in this.flags&&e.length>=this.flags.COMPOUNDMIN)for(var r=0,n=this.compoundRules.length;n>r;r++)if(e.match(this.compoundRules[r]))return!0;return!1}for(var r=0,n=t.length;n>r;r++)if(!this.hasFlag(e,"ONLYINCOMPOUND",t[r]))return!0;return!1},hasFlag:function(e,t,r){if(t in this.flags){if("undefined"==typeof r)var r=Array.prototype.concat.apply([],this.dictionaryTable[e]);if(r&&-1!==r.indexOf(this.flags[t]))return!0}return!1},alphabet:"",suggest:function(e,t){function r(e){for(var t=[],r=0,n=e.length;n>r;r++){for(var s=e[r],i=[],o=0,a=s.length+1;a>o;o++)i.push([s.substring(0,o),s.substring(o,s.length)]);for(var l=[],o=0,a=i.length;a>o;o++){var u=i[o];u[1]&&l.push(u[0]+u[1].substring(1))}for(var c=[],o=0,a=i.length;a>o;o++){var u=i[o];u[1].length>1&&c.push(u[0]+u[1][1]+u[1][0]+u[1].substring(2))}for(var f=[],o=0,a=i.length;a>o;o++){var u=i[o];if(u[1])for(var p=0,d=h.alphabet.length;d>p;p++)f.push(u[0]+h.alphabet[p]+u[1].substring(1))}for(var v=[],o=0,a=i.length;a>o;o++){var u=i[o];if(u[1])for(var p=0,d=h.alphabet.length;d>p;p++)f.push(u[0]+h.alphabet[p]+u[1])}t=t.concat(l),t=t.concat(c),t=t.concat(f),t=t.concat(v)}return t}function n(e){for(var t=[],r=0;r<e.length;r++)h.check(e[r])&&t.push(e[r]);return t}function s(e){function s(e,t){return e[1]<t[1]?-1:1}for(var i=r([e]),o=r(i),a=n(i).concat(n(o)),l={},u=0,c=a.length;c>u;u++)a[u]in l?l[a[u]]+=1:l[a[u]]=1;var f=[];for(var u in l)f.push([u,l[u]]);f.sort(s).reverse();for(var p=[],u=0,c=Math.min(t,f.length);c>u;u++)h.hasFlag(f[u][0],"NOSUGGEST")||p.push(f[u][0]);return p}if(t||(t=5),this.check(e))return[];for(var i=0,o=this.replacementTable.length;o>i;i++){var a=this.replacementTable[i];if(-1!==e.indexOf(a[0])){var l=e.replace(a[0],a[1]);if(this.check(l))return[l]}}var h=this;return h.alphabet="abcdefghijklmnopqrstuvwxyz",s(e)}};var r,n=0,s=!1,i=!1,o="",a="";e.defineMode("spell-checker",function(l,h){function u(){r=new t("en_US",o,a,{platform:"any"});for(var e=document.getElementsByClassName("CodeMirror"),n=0;n<e.length;++n){var s=e[n].CodeMirror;if(s){var i=s.getMode();i&&"spell-checker"===i.name&&(s.setOption("mode",i.backdrop),s.setOption("mode","spell-checker"))}}}var c=function(e,t){return-1!==e.indexOf(t)};if(!s){s=!0;var f=new XMLHttpRequest;f.open("GET","https://cdn.jsdelivr.net/codemirror.spell-checker/latest/en_US.aff",!0),f.onload=function(e){4===f.readyState&&200===f.status&&(o=f.responseText,n++,2==n&&u())},f.send(null)}if(!i){i=!0;var p=new XMLHttpRequest;p.open("GET","https://cdn.jsdelivr.net/codemirror.spell-checker/latest/en_US.dic",!0),p.onload=function(e){4===p.readyState&&200===p.status&&(a=p.responseText,n++,2==n&&u())},p.send(null)}var d='!"#$%&()*+,-./:;<=>?@[\\]^_{|}~ ',v={token:function(e,t){var n=e.peek(),s="";if(c(d,n))return e.next(),null;for(;null!=(n=e.peek())&&!c(d,n);)s+=n,e.next();return r&&!r.check(s)?"spell-error":null}},m=e.getMode(l,l.backdrop||"markdown");return e.overlayMode(m,v,!0)})});